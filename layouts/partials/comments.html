{{ if .Site.Params.comments.enabled }}
{{ if eq .Site.Params.comments.system "giscus" }}
<div class="comments-section">
  <script src="https://giscus.app/client.js" data-repo="{{ .Site.Params.giscus.repo }}"
    data-repo-id="{{ .Site.Params.giscus.repoId }}" data-category="{{ .Site.Params.giscus.category }}"
    data-category-id="{{ .Site.Params.giscus.categoryId }}" data-mapping="{{ .Site.Params.giscus.mapping }}"
    data-strict="0" data-reactions-enabled="{{ .Site.Params.giscus.reactionsEnabled }}"
    data-emit-metadata="{{ .Site.Params.giscus.emitMetadata }}"
    data-input-position="{{ .Site.Params.giscus.inputPosition }}" data-theme="dark"
    data-lang="{{ .Site.Params.giscus.lang }}" crossorigin="anonymous" async>
    </script>
</div>

<script>
  function setGiscusTheme() {
    const theme = document.documentElement.dataset.theme === 'dark' ? 'dark_high_contrast' : 'light';
    const iframe = document.querySelector('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow.postMessage({
        giscus: {
          setConfig: {
            theme: theme
          }
        }
      }, 'https://giscus.app');
    }
  }

  // Set initial theme after iframe loads
  window.addEventListener('message', (event) => {
    if (event.origin === 'https://giscus.app') {
      setGiscusTheme();
    }
  });

  // Listen for theme toggle
  const observer = new MutationObserver(() => {
    setGiscusTheme();
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>
{{ end }}
{{ end }}